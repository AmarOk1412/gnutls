\begin{verbatim}

#define PRINTX(x,y) if (y[0]!=0) printf(" -   %s %s\n", x, y)
#define PRINT_DN(X) PRINTX( "CN:", X->common_name); \
	PRINTX( "OU:", X->organizational_unit_name); \
	PRINTX( "O:", X->organization); \
	PRINTX( "L:", X->locality_name); \
	PRINTX( "S:", X->state_or_province_name); \
	PRINTX( "C:", X->country); \
	PRINTX( "E:", X->email)

int print_info(GNUTLS_STATE state)
{
   const char *tmp;

   /* print the key exchange's algorithm name
    */
   tmp = gnutls_kx_get_name(gnutls_get_current_kx(state));
   printf("- Key Exchange: %s\n", tmp);

   /* in case of X509 PKI
    */
   if (gnutls_get_auth_type(state) == GNUTLS_X509PKI) {
      const gnutls_DN* dn;
      const gnutls_datum* cert_list;
      int cert_list_size = 0;
      CertificateStatus status;
      KXAlgorithm kx;

      kx = gnutls_get_current_kx(state);

      /* Check if we have been using ephemeral Diffie Hellman.
       */
      if (kx == GNUTLS_KX_DHE_RSA || kx == GNUTLS_KX_DHE_DSS) {
         printf("\n- Ephemeral DH using prime of %d bits\n",
            gnutls_x509pki_server_get_dh_bits( state));
      }


      status = gnutls_x509pki_client_get_peer_certificate_status( state);
      cert_list = gnutls_x509pki_client_get_peer_certificate_list( state, &cert_list_size);

      switch( status) {
         case GNUTLS_CERT_NOT_TRUSTED:
           printf("- Peer's X509 Certificate was NOT verified\n");
           break;
         case GNUTLS_CERT_EXPIRED:
           printf("- Peer's X509 Certificate was verified but is expired\n");
           break;
         case GNUTLS_CERT_TRUSTED:
           printf("- Peer's X509 Certificate was verified\n");
           break;
         case GNUTLS_CERT_NONE:
           printf("- Peer did not send any certificate.\n");
           break;
         case GNUTLS_CERT_INVALID:
           printf("- Peer's X509 Certificate was invalid\n");
           break;
      }
		
      if ( cert_list_size > 0) {

         printf(" - Certificate info:\n");
         printf(" - Certificate version: #%d\n", gnutls_x509pki_extract_certificate_version( &cert_list[0]));

         gnutls_x509pki_extract_certificate_dn( &cert_list[0], &dn);
         PRINT_DN( dn);

         gnutls_x509pki_extract_certificate_issuer_dn( &cert_list[0], &dn);
         printf(" - Certificate Issuer's info:\n");
         PRINT_DN(dn);
      }
   }

   tmp = gnutls_version_get_name(gnutls_get_current_version( state));
   printf("- Version: %s\n", tmp);

   tmp = gnutls_compression_get_name(gnutls_get_current_compression_method( state));
   printf("- Compression: %s\n", tmp);

   tmp = gnutls_cipher_get_name(gnutls_get_current_cipher( state));
   printf("- Cipher: %s\n", tmp);

   tmp = gnutls_mac_get_name(gnutls_get_current_mac_algorithm( state));
   printf("- MAC: %s\n", tmp);

   return 0;
}

\end{verbatim}
